{% load static %}

<div class="container">
    <div class="header-space position-relative">
        <button id="toggleDarkModeBtn" class="btn btn-toggle-dark-mode"
            onclick="toggleDarkMode()" aria-label="Activer le mode nuit">Mode Nuit</button>
    </div>
    <div class="main-center">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">
                <section hx-ext="ws" ws-connect="/ws/terminal/{{ payment_intent.payment_intent_stripe_id }}/">
                    <div class="card">
                        <div class="card-body">
                            <div class="payment-info text-center">
                                Vous souhaitez recharger <strong>{{ amount }}‚Ç¨</strong>.
                                <br>
                                Veuillez suivre les indications du terminal de paiement √† droite de cet √©cran.
                            </div>
                            <div class="payment-icons text-center">
                                üí≥ ‚û°Ô∏è üí≥ ‚û°Ô∏è üí≥ ‚û°Ô∏è üí≥ ‚û°Ô∏è
                            </div>
                            <div class="spinner-box">
                                <div class="spinnerCB" id="spinnerCB"></div>
                            </div>
                        </div>
                    </div>

                    {# La partie retourn√© par le websocket qui est √©cras√© par le oob message #}
                    <div style="display: none">
                        <div id="message"></div>
                    </div>

                    <div class="d-flex justify-content-center" id="cancelButton">
                        <button class="btn btn-cancel"
                                style="font-size: 2.2rem; padding: 25px 40px; margin: 30px 0; box-shadow: 0 6px 12px rgba(220, 53, 69, 0.4); border: 3px solid #fff;"
                                hx-get="/htmx/kiosk/{{ payment_intent.pk }}/cancel/"
                                hx-trigger="click" hx-target="#cancelButton" hx-swap="outerHTML">
                            ‚ùå ANNULER
                        </button>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>

<script>
    // Update dark mode state based on parent page
    document.addEventListener("DOMContentLoaded", function() {
        // Check if dark mode is active in the parent page
        if (document.body.classList.contains("dark-mode")) {
            const elements = document.querySelectorAll(
                ".main-center, .card, .btn-cancel, .btn-toggle-dark-mode"
            );
            elements.forEach((el) => el.classList.add("dark-mode"));

            // Update dark mode button
            const button = document.getElementById("toggleDarkModeBtn");
            if (button) {
                button.innerHTML = 'Mode Jour';
                button.setAttribute('aria-label', 'Activer le mode jour');
            }

            // Update cancel button styling for dark mode
            const cancelButton = document.querySelector(".btn-cancel");
            if (cancelButton) {
                cancelButton.style.border = "3px solid #2d2d2d";
                cancelButton.style.backgroundColor = "#e63946";
                cancelButton.style.boxShadow = "0 6px 12px rgba(230, 57, 70, 0.5)";
            }
        }
    });
</script>
