{% load webviewTags %}
{% load i18n %}
{% load static %}

<style>
.order-validate {
  height: 60px;
  padding: 4px 10px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border: none;
  margin: 0 2px;
}

.order-article-no-display {
  display: none;
}

.order-show-article {
  display: flex;
}

.order-sel-mpayment {
  height: 60px;
  margin: 0 2px;
  padding: 0;
  font-size: 1rem;
  overflow: hidden;
}

.order-sel-mpayment input {
  display: none;
} 

.order-sel-mpayment:has(input:checked) label {
  background: red;
} 

.order-sel-mpayment label {
  width: 100%;
  height: 100%;
  padding: 4px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border: 1px solid #ffffff;
}
</style>
<input type="hidden" name="uuid_command" value="{{ uuid_command }}" />
{% with first_article=cmd.articles.0 %}
    <div class="order-legende-time-w BF-ligne">{{ first_article.date_time|time:"H:i" }}</div>
    <!-- articles -->
    <div class="order-legende-articles-w BF-col">
      {% for article in cmd.articles %}
        <div {% if cmd.articles|length > 1 and forloop.counter > 1 %} class="order-article-no-display order-article-display-{{ forloop.parentloop.counter }}" {% endif %}>
          <span>{{ article.qty|floatformat:0 }} x {{ article.article.name }}</span>
          {% if cmd.articles|length > 1 and forloop.counter == 1 %}
          <span onclick="commandShowArticles('order-article-display-{{ forloop.parentloop.counter }}')">....</span>
          {% endif %}
        </div>
      {% endfor %}
    </div>
    <div class="order-legende-prix-w BF-ligne">{{ cmd.total|floatformat:2 }}</div>
    <div class="order-legende-mpayment-w BF-ligne">{{ first_article.moyen_paiement }}</div>
    <div class="order-legende-update-mpayment-w BF-ligne">
      <!-- moyens de paiement -->
      {% for paiement in moyens_paiement %}
      <div class="order-sel-mpayment">
        {% with uuid=paiement.id|stringformat:"s" %}
        <input type="radio" id="order-payment-radio-{{ uuid }}-{{ uuid_command }}" name="method_payment_{{ uuid_command }}" value="{{ uuid }}" 
          {% if forloop.counter == 1 %} required {% endif %} />
        <label for="order-payment-radio-{{ uuid }}-{{ uuid_command }}" onclick="deselectPayment(event)">{{ paiement.name }}</label>
        {% endwith %}
      </div>
      {% endfor %}
      <!-- bt valider -->
      <button class="order-validate order-bt fond-ok coulBlanc" hx-indicator="#ind-{{ forloop.counter }}" on>
        <div>Valider</div>
        <img id="ind-{{ forloop.counter }}" src="{% static 'htmxview/bars.svg' %}" class="htmx-indicator"/>
      </button>
    </div>
{% endwith %}

<script>
// click on 3 dots show command's articles 
function commandShowArticles(cibles) {
  document.querySelectorAll('.' + cibles).forEach(ele => {
    ele.classList.toggle("order-show-article")
  })
}

// deselectPayment = unchecked
function deselectPayment(event) {
  // console.log('-> ', event.target)
  document.querySelectorAll('.order-legende-update-mpayment-w input[type="radio"]').forEach(ele => {
    if (event.target !== ele) {
      ele.checked = false
    }
  })
}
</script>