{% load webviewTags %}
{% load i18n %}

<style>
.order-validate {
  height: 60px;
  padding: 4px 10px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border: none;
  margin: 0 2px;
}

.order-article-no-display {
  display: none;
}

.order-show-article {
  display: flex;
}

.order-sel-mpayment {
  width: 18%;
  height: 60px;
  margin: 0 2px;
  padding: 0;
}

.order-sel-mpayment input {
  display: none;
} 

.order-sel-mpayment:has(input:checked) label {
  background: red;
} 

.order-sel-mpayment label {
  width: 100%;
  height: 100%;
  padding: 4px 10px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border: 1px solid #ffffff;
}
</style>

<input type="hidden" name="uuid_command" value="{{ uuid_command }}" />

{% with first_article=cmd.articles.0 %}
    <div class="order-legende-time-w BF-ligne">{{ first_article.date_time|time:"H:i" }}</div>
    <!-- articles -->
    <div class="order-legende-articles-w BF-col">
      {% for article in cmd.articles %}
        <div {% if cmd.articles|length > 1 and forloop.counter > 1 %} class="order-article-no-display order-article-display-{{ forloop.parentloop.counter }}" {% endif %}>
          <span>{{ article.qty|floatformat:0 }} x {{ article.article.name }}</span>
          {% if cmd.articles|length > 1 and forloop.counter == 1 %}
          <span onclick="commandShowArticles('order-article-display-{{ forloop.parentloop.counter }}')">....</span>
          {% endif %}
        </div>
      {% endfor %}
    </div>
    <div class="order-legende-prix-w BF-ligne">{{ cmd.total|floatformat:2 }}</div>
    <div class="order-legende-mpayment-w BF-ligne">{{ first_article.moyen_payment|translate }}</div>
    <div class="order-legende-update-mpayment-w BF-ligne">
      <!-- espèces -->
      {% if first_article.pos.accepte_especes %}
      <div class="order-sel-mpayment">
        <input type="radio" id="order-payment-radio-espece-{{ uuid_command }}" name="method_payment_{{ uuid_command }}" value="espece" onclick="deselectPayment(event)" />
        <label for="order-payment-radio-espece-{{ uuid_command }}">{% trans 'Espèces' %}</label>
      </div>
      {% endif %}
      <!-- cb -->
      {% if first_article.pos.accepte_carte_bancaire %}
      <div class="order-sel-mpayment">
        <input type="radio" id="order-payment-radio-cb-{{ uuid_command }}" name="method_payment_{{ uuid_command }}" value="cb" onclick="deselectPayment(event)"/>
        <label for="order-payment-radio-cb-{{ uuid_command }}">{% trans 'CB' %}</label>
      </div>
      {% endif %}
      <!-- chèque -->
      {% if first_article.pos.accepte_cheque %}
      <div class="order-sel-mpayment">
        <input type="radio" id="order-payment-radio-cheque-{{ uuid_command }}" name="method_payment_{{ uuid_command }}" value="cheque" onclick="deselectPayment(event)"/>
        <label for="order-payment-radio-cheque-{{ uuid_command }}">{% trans 'Chèque' %}</label>
      </div>
      {% endif %}
      <!-- cashless -->
      <div class="order-sel-mpayment">
        <input type="radio" id="order-payment-radio-cashless-{{ uuid_command }}" name="method_payment_{{ uuid_command }}" value="cashless" onclick="deselectPayment(event)"/>
        <label for="order-payment-radio-cashless-{{ uuid_command }}">cashless</label>
      </div>
      <!-- bt valider -->
      <button hx-post="/htmx/sales/change_payment_method/" hx-target="#order-target-{{ uuid_command }}" hx-swap="innerHTML"
        class="order-validate order-bt fond-ok coulBlanc">
        Valider
      </button>
    </div>
{% endwith %}

<script>
function commandShowArticles(cibles) {
  document.querySelectorAll('.' + cibles).forEach(ele => {
    ele.classList.toggle("order-show-article")
  })
}

// deselectPayment = unchecked
function deselectPayment(event) {
  <!-- console.log('-> ', event.target) -->
  document.querySelectorAll('.order-legende-update-mpayment-w input[type="radio"]').forEach(ele => {
    if (event.target !== ele) {
      ele.checked = false
    }
  })
}
</script>