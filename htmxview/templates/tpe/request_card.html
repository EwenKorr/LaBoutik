{% load static %}

<link rel="stylesheet" href="{% static 'webview/css/bootstrap.min.css' %}">

<div id="tb-kiosque" class="BF-col">
  <h1>request card</h1>
  <div>{{ tag_id }}</div>
</div>


<script>
  function sendTagId(data) {
    console.log('-> sendTagId, tagId =', data.tagId)

    htmx.ajax('post', '/htmx/payment_intent_tpe/check_request_card/', {
      target: '#tb-kiosque',
      swap: 'outerHTML',
      values: { tag_id: data.tagId }
    })
  }


  // lecture de carte
  {% if tag_id == None %}
  // Initialise et détermine le type de lecteur NFC(RFID) (interne/serveur/DEMO)
  rfid.initModeLectureNfc()
  // message lors de la lecture de code
  rfid.muteEtat('message', `<div style="white-space: pre-line; text-align: center;" role="status" aria-label="waiting card" ">Kiosque - attente carte </div>`)
  // une fois le tag id lu lance la méthode "sendTagId"
  rfid.muteEtat('callbackOk', sendTagId)
  // console.log('glob.data =', glob.data);
  if (glob.data.length === 1) {
    rfid.muteEtat('tagIdIdentite', 'cm') // n'affiche pas de bouton retour
  } else {
    rfid.muteEtat('tagIdIdentite', 'divers') // affiche le bouton retour
    
    // --- ajoute des fonctions au bouton retour de kiosque ---
    // efface la div contenant kiosque
    let addFunctions = "document.querySelector('#tb-kiosque').style.display = 'none';"
    // si kiosque premier point de ventes le bt retour de kiosque ramènera au pv + 1
    const pvIndex = vue_pv.retourne_index_pv(pv_uuid_courant)
    const comportement = (glob.data.find(pv => pv.id === pv_uuid_courant)).comportement
    if(pvIndex === 0 && comportement === "K") {
      addFunctions+= `vue_pv.initDataPVcourant('${pvIndex+1}')`
    }
    rfid.muteEtat('options', { addFunctionsToBtReturn: addFunctions })
  }
  // lance la lecture de carte
  rfid.lireTagId()
  {% endif %}

  function validateAmount() {
    const amount = document.getElementById('amount').value;
    if (!amount || amount <= 0) {
      alert('Veuillez entrer un montant valide');
      return false;
    }
    return true;
  }
</script>

<style>
  #tb-kiosque {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: var(--bleu10);
    color: var(--blanc01);
  }

  /*
  body {
    padding-top: 20px;
    padding-bottom: 20px;
    background-color: #f8f9fa;
  }
*/
  .terminal-button {
    margin-bottom: 15px;
    height: 100px;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .terminal-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .amount-input {
    margin-bottom: 20px;
  }

  .card {
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }

  .card:hover {
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
  }

  .page-header {
    border-bottom: 2px solid #007bff;
    margin-bottom: 30px;
    padding-bottom: 10px;
  }

  .form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, .25);
  }
</style>