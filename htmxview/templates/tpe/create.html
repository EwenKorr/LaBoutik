{% load static %}
<script src="{% static 'webview/js/htmx@2.0.3.min.js' %}"></script>
<script src="{% static 'webview/js/htmx-ext-ws@2.0.3.js' %}"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<style>
    body {
        background-color: #f5f5f5;
        font-family: 'Roboto', sans-serif;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
    }
    .header {
        display: flex;
        align-items: center;
        margin-bottom: 30px;
    }
    .header h2 {
        flex-grow: 1;
        text-align: center;
        margin: 0;
    }
    .terminal-info {
        background-color: #fff;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16);
    }
    .status-container {
        background-color: #fff;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16);
    }
    .status-label {
        font-weight: bold;
        margin-right: 8px;
    }
    .message-container {
        background-color: #fff;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
        min-height: 100px;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16);
    }
    .form-container {
        background-color: #fff;
        border-radius: 8px;
        padding: 16px;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16);
    }
    .amount-input {
        width: 100%;
        margin-bottom: 16px;
    }
    .submit-button {
        width: 100%;
    }
</style>

<div class="container">
    <div class="header">
        <h2 class="mdl-typography--headline">Paiement en cours</h2>
        <a href="/payment_intent_tpe/start/" class="mdl-button mdl-js-button mdl-button--icon">
            <i class="material-icons">arrow_back</i>
        </a>
    </div>

    <div class="terminal-info" id="terminal-info">
        <h4 class="mdl-typography--title">Appareil</h4>
        <p class="mdl-typography--body-1">{{ terminal.name }} ({{ terminal.id.hex }})</p>
    </div>

    <div class="status-container" hx-ext="ws" ws-connect="/ws/terminal/{{ terminal.id.hex }}/">
        <h4 class="mdl-typography--title">Statut</h4>
        <div id="notification">
            <p class="mdl-typography--body-1">
                <span class="status-label">Terminal :</span> {{ terminal.status }}
            </p>
            <p class="mdl-typography--body-1">
                <span class="status-label">Paiement :</span> {{ payment_intent.status }}
            </p>
        </div>

        <div id="message" class="message-container">
            <p class="mdl-typography--body-1">En attente de communication avec le terminal...</p>
        </div>

        <div class="form-container">
            <form id="form" ws-send>
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label amount-input">
                    <input class="mdl-textfield__input" name="amount" type="number" step="0.01" id="amount" value="{{ payment_intent.amount }}">
                    <label class="mdl-textfield__label" for="amount">Montant (€)</label>
                </div>
                <div class="button-container" style="display: flex; gap: 16px; margin-bottom: 16px;">
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" style="flex: 1;" type="submit">
                        <i class="material-icons">send</i>
                        Envoyer
                    </button>
                </div>
                <div class="button-container" style="display: flex; gap: 16px;">
                    <a href="/payment_intent_tpe/retry/{{ payment_intent.id }}/" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored" style="flex: 1;">
                        <i class="material-icons">refresh</i>
                        Réessayer
                    </a>
                    <a href="/payment_intent_tpe/cancel/{{ terminal.id }}/" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" style="flex: 1;">
                        <i class="material-icons">cancel</i>
                        Annuler
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
